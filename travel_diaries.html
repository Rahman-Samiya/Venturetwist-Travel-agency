<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Travel Diaries - User Travel Stories</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: #f9fafb;
    color: #212121;
  }
  header {
    background: #38c7b4;
    color: white;
    padding: 1.5rem 2rem;
    text-align: center;
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: 1px;
    box-shadow: 0 4px 10px #38c7b4(0,119,182,0.3);
  }
  main {
    max-width: 960px;
    margin: 2.5rem auto 4rem;
    padding: 0 1rem;
  }
  .post {
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.07);
    overflow: hidden;
    margin-bottom: 2.8rem;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
  }
  .post:hover {
    transform: translateY(-5px);
  }
  .post-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-bottom: 1.5px solid #e0e0e0;
  }
  .post-content {
    padding: 1.8rem 2rem;
    display: flex;
    flex-direction: column;
  }
  .post-header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 0.8rem;
  }
  .post-title {
    font-size: 1.7rem;
    font-weight: 700;
    color: #38c7b4;
    margin: 0;
    flex-grow: 1;
  }
  .tags {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
    flex-wrap: wrap;
  }
  .tag {
    background: #caf0f8;
    color:#38c7b4;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.85rem;
    user-select: none;
  }
  .post-text {
    font-size: 1.1rem;
    line-height: 1.5;
    color: #333;
    margin-top: 1.2rem;
    white-space: pre-line;
  }
  .interaction-bar {
    margin-top: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .likes {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    color: #38c7b4;
    font-weight: 700;
    transition: color 0.3s ease;
  }
  .likes:hover {
    color: #38c7b4;
  }
  .likes svg {
    width: 22px;
    height: 22px;
    fill: currentColor;
    transition: transform 0.15s ease;
  }
  .likes.liked svg {
    transform: scale(1.2);
    fill: #d00000;
  }
  .comments-section {
    margin-top: 1.6rem;
  }
  .comments-list {
    max-height: 140px;
    overflow-y: auto;
    border-left: 3px solid #38c7b4;
    padding-left: 1rem;
    margin-bottom: 1rem;
  }
  .comment {
    font-size: 0.92rem;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
  }
  .comment b {
    color: #38c7b4;
  }
  .comment-form {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    align-items: center;
  }
  .comment-form input[type="text"] {
    flex: 1 1 auto;
    padding: 0.5rem 1rem;
    font-size: 0.95rem;
    border-radius: 25px;
    border: 1.5px solid #38c7b4;
    outline-offset: 3px;
    transition: border-color 0.3s ease;
  }
  .comment-form input[type="text"]:focus {
    border-color: #38c7b4;
  }
  .comment-form button {
    background: #38c7b4;
    color: white;
    border: none;
    border-radius: 25px;
    padding: 0.5rem 1.4rem;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    flex-shrink: 0;
  }
  .comment-form button:hover {
    background: #38c7b4;
  }
  .post-actions {
    margin-top: 1.8rem;
    display: flex;
    gap: 1.2rem;
  }
  button.edit-btn,
  button.delete-btn {
    border: 2px solid #38c7b4;
    background: #e0f2fe;
    color: #38c7b4;
    cursor: pointer;
    padding: 0.5rem 1.4rem;
    font-weight: 700;
    border-radius: 25px;
    font-size: 0.9rem;
    user-select: none;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  button.edit-btn:hover,
  button.delete-btn:hover {
    background: #38c7b4;
    color: white;
  }
  .new-post-form {
    background: #e0f7fa;
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  .new-post-form input[type="text"],
  .new-post-form textarea {
    width: 100%;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border: 1.5px solid #38c7b4;
    border-radius: 5px;
    font-size: 1rem;
  }
  .new-post-form input[type="file"] {
    margin-bottom: 1rem;
  }
  .new-post-form button {
    background: #38c7b4;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 0.5rem 1.5rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .new-post-form button:hover {
    background: #38c7b4;
  }
  @media (max-width: 600px) {
    .post-header {
      flex-direction: column;
      align-items: flex-start;
    }
    .post-title {
      margin-bottom: 0.35rem;
    }
  }
</style>
</head>
<body>
<header>
  Travel Diaries - User Travel Stories
</header>
<main>
  <div class="new-post-form">
    <h2>Create New Post</h2>
    <input type="text" id="new-title" placeholder="Post Title" required />
    <textarea id="new-content" rows="4" placeholder="Post Content" required></textarea>
    <input type="text" id="new-tags" placeholder="Tags (comma separated)" />
    <input type="file" id="new-image" accept="image/*" required />
    <button id="create-post-btn">Create Post</button>
  </div>

  <div id="posts-container"></div>
</main>
<script>
  // Load posts from local storage
  function loadPostsFromLocalStorage() {
    const storedPosts = localStorage.getItem('posts');
    return storedPosts ? JSON.parse(storedPosts) : [];
  }

  // Save posts to local storage
  function savePostsToLocalStorage(posts) {
    localStorage.setItem('posts', JSON.stringify(posts));
  }

  // Initialize posts
  let posts = loadPostsFromLocalStorage();
  const postsContainer = document.getElementById("posts-container");
  const createPostBtn = document.getElementById("create-post-btn");

  function sanitize(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function createPostElement(post) {
    const postEl = document.createElement('article');
    postEl.classList.add('post');
    postEl.innerHTML = `
      <img src="${post.image}" alt="Photo for ${sanitize(post.title)}" class="post-image" />
      <div class="post-content">
        <div class="post-header">
          <h2 class="post-title">${sanitize(post.title)}</h2>
          <div class="tags">${post.tags.map(tag => `<span class="tag">${sanitize(tag)}</span>`).join('')}</div>
        </div>
        <p class="post-text">${sanitize(post.content)}</p>
        <div class="interaction-bar">
          <div class="likes" title="Like this post" data-id="${post.id}" role="button" tabindex="0" aria-pressed="false" aria-label="Like post titled ${sanitize(post.title)}">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.54 0 3.04.99 3.57 2.36h1.87C14.46 4.99 15.96 4 17.5 4 20 4 22 6 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
            <span class="likes-count">${post.likes}</span>
          </div>
        </div>
        <section class="comments-section" aria-label="Comments section">
          <div class="comments-list">
            ${post.comments.map(c => `<div class="comment"><b>${sanitize(c.username)}</b>: ${sanitize(c.text)}</div>`).join('')}
          </div>
          <form class="comment-form" data-id="${post.id}" aria-label="Add comment form">
            <input type="text" name="username" placeholder="Your name" aria-label="Your name" required minlength="2" maxlength="30" />
            <input type="text" name="comment" placeholder="Write a comment..." aria-label="Write a comment" required minlength="1" maxlength="200" />
            <button type="submit">Post</button>
          </form>
        </section>
        <div class="post-actions" aria-label="Post actions">
          <button class="edit-btn" title="Edit post" onclick="editPost(${post.id})">Edit</button>
          <button class="delete-btn" title="Delete post" onclick="deletePost(${post.id})">Delete</button>
        </div>
      </div>
    `;
    return postEl;
  }

  function renderPosts() {
    postsContainer.innerHTML = "";
    posts.forEach(post => {
      postsContainer.appendChild(createPostElement(post));
    });
  }

  // Create new post
  createPostBtn.addEventListener("click", () => {
    const title = document.getElementById("new-title").value.trim();
    const content = document.getElementById("new-content").value.trim();
    const tags = document.getElementById("new-tags").value.split(',').map(tag => tag.trim()).filter(tag => tag);
    const imageInput = document.getElementById("new-image");
    const imageFile = imageInput.files[0];

    if (title && content && imageFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const newPost = {
          id: Date.now(), // Use timestamp as a unique ID
          title: title,
          content: content,
          tags: tags,
          image: e.target.result, // Use the file reader result
          likes: 0,
          comments: []
        };
        posts.push(newPost);
        savePostsToLocalStorage(posts); // Save to local storage
        renderPosts();
        // Reset the form
        document.getElementById("new-title").value = '';
        document.getElementById("new-content").value = '';
        document.getElementById("new-tags").value = '';
        imageInput.value = ''; // Reset file input
      };
      reader.readAsDataURL(imageFile); // Read the image file as a data URL
    }
  });

  renderPosts();

  // Like functionality
  postsContainer.addEventListener("click", e => {
    const likeBtn = e.target.closest('.likes');
    if (!likeBtn) return;
    const postId = Number(likeBtn.dataset.id);
    const post = posts.find(p => p.id === postId);
    if (!post) return;

    post.likes++;
    likeBtn.querySelector('.likes-count').textContent = post.likes;
    likeBtn.classList.add('liked');
    // For accessibility
    likeBtn.setAttribute('aria-pressed', 'true');
    savePostsToLocalStorage(posts); // Save to local storage
  });

  // Comment submission
  postsContainer.addEventListener("submit", e => {
    e.preventDefault();
    const form = e.target;
    if (!form.classList.contains('comment-form')) return;
    const postId = Number(form.dataset.id);
    const post = posts.find(p => p.id === postId);
    if (!post) return;

    const usernameField = form.querySelector('input[name="username"]');
    const commentField = form.querySelector('input[name="comment"]');
    const username = usernameField.value.trim();
    const comment = commentField.value.trim();

    if (!username || !comment) return;

    post.comments.push({ username, text: comment });
    savePostsToLocalStorage(posts); // Save to local storage

    const commentsList = form.querySelector('.comments-list') || form.previousElementSibling;
    if (commentsList) {
      const newComment = document.createElement('div');
      newComment.classList.add('comment');
      newComment.innerHTML = `<b>${sanitize(username)}</b>: ${sanitize(comment)}`;
      form.previousElementSibling.appendChild(newComment);
    }
    form.reset();
  });

  // Edit post function
  function editPost(postId) {
    const post = posts.find(p => p.id === postId);
    if (post) {
      const newText = prompt("Edit your post:", post.content);
      if (newText !== null) {
        post.content = newText; // Update the content in the posts array
        savePostsToLocalStorage(posts); // Save to local storage
        renderPosts(); // Re-render the posts to reflect changes
      }
    }
  }

  // Delete post function
  function deletePost(postId) {
    const confirmDelete = confirm("Are you sure you want to delete this post?");
    if (confirmDelete) {
      const postIndex = posts.findIndex(p => p.id === postId);
      if (postIndex > -1) {
        posts.splice(postIndex, 1); // Remove the post from the array
        savePostsToLocalStorage(posts); // Save to local storage
        renderPosts(); // Re-render the posts to reflect changes
      }
    }
  }
</script>
</body>
</html>
